image:
- Visual Studio 2017

# Test agains
environment:
  matrix:
    - nodejs_version: '8'

# Fix line endings in Windows. (runs before repo cloning)
init:
  - git config --global core.autocrlf input

# Install scripts--runs after repo cloning
install:
  # Install the latest stable version of Node
  - ps: Install-Product node $env:nodejs_version x64
  - set PATH=%APPDATA%\yarn;%PATH%
  - yarn
  - ps: ./Scripts/windows-ci-desktop-layout.ps1

# Disable automatic builds
build: off

# Post-install test scripts
test_script:
  # Output debugging info
  - node --version
  - yarn --version
  # run tests and run build
  - yarn run eslint
  - yarn run flow
  - yarn jest -- --forceExit

artifacts:
  - path: reports
    name: Junit Reports

  - path: packages/workflow-core/test/integration/__image_snapshots__
    name: Snapshot Images

# Cache node_modules for faster builds
cache:
  - "%LOCALAPPDATA%\\Yarn"
  - node_modules -> package.json
